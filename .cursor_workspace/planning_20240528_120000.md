# 日本語住所正規化ツール実装計画

## 日本の住所の特徴

日本の住所は一般的に以下の構造を持っています：

1. **郵便番号**：オプション（例：〒123-4567）
2. **都道府県**：47都道府県のいずれか
3. **市区町村**：市、区、町、村のいずれか
4. **町名**：地域の名称
5. **番地**：数字とハイフンの組み合わせ（例：1-2-3）
6. **建物名・部屋番号**：オプション

### 特徴と課題

- 都道府県名と市区町村名が連続して書かれることが多い（例：東京都新宿区）
- 番地の表記方法が多様（1番2号、1-2-3、一丁目二番三号など）
- 建物名や部屋番号の表記も多様
- 省略形や略称が使われることがある（例：東京→東京都）
- 全角・半角の混在
- 区切り文字の有無や種類の違い

## 実装ステップ

### ステップ1: 基本構造の設計とテスト環境の構築
- プロジェクト構造の設定
- テスト環境の構築（pytestの設定）
- 基本的なクラス・関数の設計

### ステップ2: 都道府県の抽出機能実装
- 47都道府県のリストを作成
- 住所文字列から都道府県を抽出する機能の実装
- 基本的なテストケースの作成と実行

### ステップ3: 市区町村の抽出機能実装
- 市区町村を抽出する機能の実装
- 基本的なテストケースの作成と実行

### ステップ4: 町名・番地の抽出機能実装
- 町名と番地を抽出する機能の実装
- 基本的なテストケースの作成と実行

### ステップ5: その他の要素（建物名・部屋番号など）の抽出機能実装
- 残りの部分から建物名や部屋番号を抽出する機能の実装
- 基本的なテストケースの作成と実行

### ステップ6: 正規化機能の実装
- 全角・半角の統一
- 省略形や略称の標準化
- 区切り文字の統一

### ステップ7: エッジケースへの対応
- 特殊な住所形式への対応
- エラー処理の実装
- 複雑なテストケースの作成と実行

### ステップ8: 統合テストと最終調整
- すべての機能を統合したテスト
- パフォーマンスの最適化
- ドキュメントの作成

## テストケース

### 基本的なテストケース
1. 標準的な住所形式（都道府県、市区町村、町名番地、建物名がすべて含まれる）
2. 郵便番号付きの住所
3. 建物名・部屋番号なしの住所

### エッジケース
1. 都道府県名が省略されている住所
2. 特殊な番地表記（丁目、番地、号など漢字表記）
3. 区切り文字が異なる住所（スペース、カンマなど）
4. 全角・半角が混在する住所
5. 住所の一部が欠落している不完全な住所

## 実装詳細

### 使用するライブラリ
- pytest: テスト駆動開発のためのテストフレームワーク
- re: 正規表現を使用した住所解析

### データ構造
住所を以下の構造で表現します：
```python
{
    "prefecture": "都道府県名",
    "city": "市区町村名",
    "town_street": "町名番地",
    "other": "建物名・部屋番号など"
}
```

### 主要な関数
1. `parse_address(address_string)`: 住所文字列を解析して構造化データを返す
2. `extract_prefecture(address_string)`: 都道府県を抽出
3. `extract_city(address_string, prefecture)`: 市区町村を抽出
4. `extract_town_street(address_string, prefecture, city)`: 町名番地を抽出
5. `extract_other(address_string, prefecture, city, town_street)`: その他の要素を抽出
6. `normalize_address(address_dict)`: 抽出した住所を正規化 